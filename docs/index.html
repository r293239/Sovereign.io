<!DOCTYPE html>
<html>
<head>
    <title>Sovereign.io - Enhanced Territory Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0a;
            color: white;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: #1a1a1a;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .game-area {
            display: flex;
            gap: 15px;
            flex: 1;
            min-height: 0;
        }

        .map-container {
            position: relative;
            flex: 1;
            background: #111;
            border-radius: 8px;
            border: 2px solid #3498db;
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
            cursor: crosshair;
        }

        .control-panel {
            width: 300px;
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel-section {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 6px;
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin: 2px;
            transition: background 0.2s;
        }

        button:hover {
            background: #2980b9;
        }

        .resource-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
        }

        .balance-bar {
            width: 200px;
            height: 20px;
            background: #34495e;
            border-radius: 10px;
            overflow: hidden;
        }

        .balance-fill {
            height: 100%;
            background: #2ecc71;
            transition: width 0.3s;
        }

        .research-tree {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
        }

        .research-node {
            background: #34495e;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .research-node.unlocked {
            background: #27ae60;
        }

        .research-node.available {
            border-color: #f39c12;
        }

        .game-log {
            height: 120px;
            overflow-y: auto;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè∞ Sovereign.io</h1>
            <div class="resource-bar">
                <span>Balance:</span>
                <div class="balance-bar">
                    <div id="balanceFill" class="balance-fill" style="width: 100%"></div>
                </div>
                <span id="balanceText">1000/1000</span>
                <span>Income: <span id="incomeText">+50</span></span>
            </div>
        </div>

        <div class="game-area">
            <div class="map-container">
                <canvas id="gameCanvas" width="800" height="600"></canvas>
            </div>
            
            <div class="control-panel">
                <div class="panel-section">
                    <h3>‚öîÔ∏è Military Actions</h3>
                    <button onclick="sendTroops(0.1)">Send 10%</button>
                    <button onclick="sendTroops(0.25)">Send 25%</button>
                    <button onclick="sendTroops(0.5)">Send 50%</button>
                    <button onclick="sendTroops(0.75)">Send 75%</button>
                    <button onclick="sendTroops(1)">Send 100%</button>
                    <div style="margin-top: 10px;">
                        <button onclick="setFrontlineMode()">Frontline Mode</button>
                        <button onclick="setExpansionMode()">Expansion Mode</button>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>üî¨ Research Tree</h3>
                    <div class="research-tree">
                        <div class="research-node" onclick="research('military')" id="militaryResearch">
                            Military Tactics<br>
                            <small>+20% Attack</small>
                        </div>
                        <div class="research-node" onclick="research('economic')" id="economicResearch">
                            Economic Growth<br>
                            <small>+25% Income</small>
                        </div>
                        <div class="research-node" onclick="research('expansion')" id="expansionResearch">
                            Rapid Expansion<br>
                            <small>Faster Claiming</small>
                        </div>
                        <div class="research-node" onclick="research('defense')" id="defenseResearch">
                            Defense Systems<br>
                            <small>+30% Defense</small>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>üèóÔ∏è Construction</h3>
                    <button onclick="buildOutpost()">Build Outpost (200)</button>
                    <button onclick="buildFortress()">Build Fortress (500)</button>
                    <button onclick="upgradeCapital()">Upgrade Capital (1000)</button>
                </div>

                <div class="panel-section">
                    <h3>üìä Game Info</h3>
                    <div>Territories: <span id="territoryCount">1</span></div>
                    <div>Frontlines: <span id="frontlineCount">0</span></div>
                    <div>Research: <span id="researchCount">0</span>/4</div>
                    <div>Buildings: <span id="buildingCount">0</span></div>
                </div>

                <div class="panel-section">
                    <h3>üìú Game Log</h3>
                    <div id="gameLog" class="game-log"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Game State
        const gameState = {
            player: {
                balance: 1000,
                maxBalance: 1000,
                income: 50,
                territories: new Set(),
                frontlines: [],
                research: new Set(),
                buildings: [],
                mode: 'expansion' // 'frontline' or 'expansion'
            },
            enemies: [],
            map: [],
            selectedArea: null,
            lastTick: Date.now()
        };

        // Canvas setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Initialize game
        function initGame() {
            createMap();
            setupPlayer();
            setupEnemies();
            
            // Game loop
            setInterval(gameTick, 100);
            setInterval(incomeTick, 1000);
            
            addGameLog('Game started! Use percentage buttons to send troops.');
            addGameLog('Research technologies to gain advantages.');
        }

        function createMap() {
            // Create a 800x600 map with territories
            for (let x = 0; x < 800; x += 2) {
                for (let y = 0; y < 600; y += 2) {
                    gameState.map.push({
                        x, y,
                        owner: null,
                        troops: 0
                    });
                }
            }
        }

        function setupPlayer() {
            // Give player starting territory in center
            const startX = 400;
            const startY = 300;
            
            for (let x = startX - 20; x <= startX + 20; x += 2) {
                for (let y = startY - 20; y <= startY + 20; y += 2) {
                    const territory = gameState.map.find(t => t.x === x && t.y === y);
                    if (territory) {
                        territory.owner = 'player';
                        territory.troops = 10;
                        gameState.player.territories.add(`${x}-${y}`);
                    }
                }
            }
            
            render();
        }

        function setupEnemies() {
            // Create 3 AI enemies
            const enemyPositions = [
                { x: 100, y: 100, color: '#e74c3c' },
                { x: 700, y: 100, color: '#f39c12' },
                { x: 400, y: 500, color: '#9b59b6' }
            ];
            
            enemyPositions.forEach((pos, index) => {
                const enemy = {
                    id: `enemy${index}`,
                    color: pos.color,
                    balance: 800,
                    maxBalance: 800,
                    income: 40,
                    territories: new Set(),
                    frontlines: []
                };
                
                // Give enemy starting territory
                for (let x = pos.x - 15; x <= pos.x + 15; x += 2) {
                    for (let y = pos.y - 15; y <= pos.y + 15; y += 2) {
                        const territory = gameState.map.find(t => t.x === x && t.y === y);
                        if (territory) {
                            territory.owner = enemy.id;
                            territory.troops = 8;
                            enemy.territories.add(`${x}-${y}`);
                        }
                    }
                }
                
                gameState.enemies.push(enemy);
            });
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw territories
            gameState.map.forEach(territory => {
                if (territory.owner === 'player') {
                    ctx.fillStyle = '#2ecc71';
                } else if (territory.owner) {
                    const enemy = gameState.enemies.find(e => e.id === territory.owner);
                    ctx.fillStyle = enemy ? enemy.color : '#34495e';
                } else {
                    ctx.fillStyle = '#34495e';
                    return;
                }
                
                ctx.fillRect(territory.x, territory.y, 2, 2);
                
                // Draw troop concentration
                if (territory.troops > 5) {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                    ctx.beginPath();
                    ctx.arc(territory.x + 1, territory.y + 1, Math.min(territory.troops / 10, 3), 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            // Draw frontlines
            gameState.player.frontlines.forEach(frontline => {
                ctx.strokeStyle = '#ff0000';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(frontline.x, frontline.y, 8, 0, Math.PI * 2);
                ctx.stroke();
            });
        }

        // OpenFront.io-like percentage sending
        function sendTroops(percentage) {
            if (gameState.player.balance <= 0) return;
            
            const troopsToSend = Math.floor(gameState.player.balance * percentage);
            gameState.player.balance -= troopsToSend;
            
            if (gameState.player.mode === 'frontline' && gameState.player.frontlines.length > 0) {
                // Send to frontline
                const frontline = gameState.player.frontlines[0];
                deployTroops(frontline.x, frontline.y, troopsToSend, 'player');
                addGameLog(`Sent ${troopsToSend} troops to frontline`);
            } else {
                // Expansion mode - find border territories
                const borderTerr = findBorderTerritories();
                if (borderTerr.length > 0) {
                    const target = borderTerr[Math.floor(Math.random() * borderTerr.length)];
                    deployTroops(target.x, target.y, troopsToSend, 'player');
                    addGameLog(`Sent ${troopsToSend} troops for expansion`);
                }
            }
            
            updateUI();
        }

        function deployTroops(x, y, amount, owner) {
            // Find nearby territories to deploy troops
            for (let dx = -20; dx <= 20; dx += 2) {
                for (let dy = -20; dy <= 20; dy += 2) {
                    const newX = x + dx;
                    const newY = y + dy;
                    
                    if (newX >= 0 && newX < 800 && newY >= 0 && newY < 600) {
                        const territory = gameState.map.find(t => t.x === newX && t.y === newY);
                        if (territory && (territory.owner === owner || territory.owner === null)) {
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            const troopAmount = Math.max(1, Math.floor(amount * (1 - distance / 30)));
                            
                            if (territory.owner === owner) {
                                territory.troops += troopAmount;
                            } else {
                                territory.owner = owner;
                                territory.troops = troopAmount;
                                if (owner === 'player') {
                                    gameState.player.territories.add(`${newX}-${newY}`);
                                } else {
                                    const enemy = gameState.enemies.find(e => e.id === owner);
                                    if (enemy) enemy.territories.add(`${newX}-${newY}`);
                                }
                            }
                        }
                    }
                }
            }
            render();
        }

        function findBorderTerritories() {
            const borders = [];
            gameState.player.territories.forEach(coord => {
                const [x, y] = coord.split('-').map(Number);
                
                // Check adjacent territories
                for (let dx = -2; dx <= 2; dx += 2) {
                    for (let dy = -2; dy <= 2; dy += 2) {
                        if (dx === 0 && dy === 0) continue;
                        
                        const newX = x + dx;
                        const newY = y + dy;
                        const adjacent = gameState.map.find(t => t.x === newX && t.y === newY);
                        
                        if (adjacent && adjacent.owner !== 'player') {
                            borders.push(adjacent);
                        }
                    }
                }
            });
            return borders;
        }

        // Research System
        function research(tech) {
            const cost = 300;
            if (gameState.player.balance >= cost && !gameState.player.research.has(tech)) {
                gameState.player.balance -= cost;
                gameState.player.research.add(tech);
                
                // Apply research effects
                switch(tech) {
                    case 'military':
                        addGameLog('Researched Military Tactics! +20% attack power');
                        break;
                    case 'economic':
                        gameState.player.income = Math.floor(gameState.player.income * 1.25);
                        addGameLog('Researched Economic Growth! +25% income');
                        break;
                    case 'expansion':
                        addGameLog('Researched Rapid Expansion! Faster territory claiming');
                        break;
                    case 'defense':
                        addGameLog('Researched Defense Systems! +30% defense');
                        break;
                }
                
                updateResearchUI();
                updateUI();
            }
        }

        // Game ticks
        function gameTick() {
            // AI enemy actions
            gameState.enemies.forEach(enemy => {
                if (enemy.balance > enemy.maxBalance * 0.3) {
                    const randomPercent = [0.1, 0.25, 0.5][Math.floor(Math.random() * 3)];
                    const troops = Math.floor(enemy.balance * randomPercent);
                    enemy.balance -= troops;
                    
                    // Find enemy border and deploy
                    const border = findEnemyBorder(enemy);
                    if (border) {
                        deployTroops(border.x, border.y, troops, enemy.id);
                    }
                }
            });
            
            // Combat resolution
            resolveCombat();
            
            render();
        }

        function incomeTick() {
            // Player income
            const baseIncome = gameState.player.income;
            const territoryBonus = gameState.player.territories.size * 0.1;
            gameState.player.balance = Math.min(
                gameState.player.maxBalance,
                gameState.player.balance + baseIncome + territoryBonus
            );
            
            // Enemy income
            gameState.enemies.forEach(enemy => {
                enemy.balance = Math.min(
                    enemy.maxBalance,
                    enemy.balance + enemy.income + (enemy.territories.size * 0.08)
                );
            });
            
            updateUI();
        }

        function resolveCombat() {
            // Simple combat resolution between adjacent territories
            gameState.map.forEach(territory => {
                if (!territory.owner || territory.troops <= 1) return;
                
                for (let dx = -2; dx <= 2; dx += 2) {
                    for (let dy = -2; dy <= 2; dy += 2) {
                        if (dx === 0 && dy === 0) continue;
                        
                        const adjacent = gameState.map.find(t => 
                            t.x === territory.x + dx && 
                            t.y === territory.y + dy
                        );
                        
                        if (adjacent && adjacent.owner && adjacent.owner !== territory.owner) {
                            // Combat happens
                            if (territory.troops > adjacent.troops) {
                                // Attacker wins
                                const loss = Math.min(adjacent.troops, territory.troops * 0.3);
                                territory.troops -= loss;
                                adjacent.owner = territory.owner;
                                adjacent.troops = territory.troops - loss;
                                
                                // Update territory sets
                                if (territory.owner === 'player') {
                                    gameState.player.territories.add(`${adjacent.x}-${adjacent.y}`);
                                    const enemy = gameState.enemies.find(e => e.id === adjacent.owner);
                                    if (enemy) enemy.territories.delete(`${adjacent.x}-${adjacent.y}`);
                                }
                            }
                        }
                    }
                }
            });
        }

        // UI Functions
        function updateUI() {
            const balancePercent = (gameState.player.balance / gameState.player.maxBalance) * 100;
            document.getElementById('balanceFill').style.width = `${balancePercent}%`;
            document.getElementById('balanceText').textContent = 
                `${Math.floor(gameState.player.balance)}/${gameState.player.maxBalance}`;
            document.getElementById('incomeText').textContent = `+${gameState.player.income}`;
            document.getElementById('territoryCount').textContent = gameState.player.territories.size;
            document.getElementById('frontlineCount').textContent = gameState.player.frontlines.length;
            document.getElementById('researchCount').textContent = gameState.player.research.size;
            document.getElementById('buildingCount').textContent = gameState.player.buildings.length;
        }

        function updateResearchUI() {
            const researchNodes = ['military', 'economic', 'expansion', 'defense'];
            researchNodes.forEach(tech => {
                const node = document.getElementById(`${tech}Research`);
                if (gameState.player.research.has(tech)) {
                    node.className = 'research-node unlocked';
                } else {
                    node.className = 'research-node available';
                }
            });
        }

        function addGameLog(message) {
            const log = document.getElementById('gameLog');
            const entry = document.createElement('div');
            entry.textContent = `> ${message}`;
            log.prepend(entry);
            
            while (log.children.length > 8) {
                log.removeChild(log.lastChild);
            }
        }

        function setFrontlineMode() {
            gameState.player.mode = 'frontline';
            addGameLog('Mode: Frontline - troops sent to strategic points');
        }

        function setExpansionMode() {
            gameState.player.mode = 'expansion';
            addGameLog('Mode: Expansion - troops sent to borders');
        }

        // Initialize game
        initGame();
    </script>
</body>
</html>
